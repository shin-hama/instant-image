(this["webpackJsonpinstant-image"]=this["webpackJsonpinstant-image"]||[]).push([[0],{179:function(e,t,n){},299:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(46),c=n.n(a),o=(n(179),n(165)),u=n(366),s=n(9),l=n(1),h=r.createContext(void 0),d=function(e){var t=e.children,n=r.useState(),i=Object(s.a)(n,2),a=i[0],c=i[1],o=function(e){if(null!==e.clipboardData)if(e.clipboardData.files.length>0){var t=e.clipboardData.files[0];c(t)}else c(e.clipboardData.getData("Text"))};return r.useEffect((function(){return document.addEventListener("paste",o),function(){document.removeEventListener("paste",o)}}),[]),Object(l.jsx)(h.Provider,{value:a,children:t})},j=r.createContext(void 0),b=function(e){var t=e.children,n=r.useRef(null);return Object(l.jsx)(j.Provider,{value:n,children:t})},x=n(23),f=n(357),v=n(344),g=Object(v.a)("input")((function(e){var t=e.theme;return{width:"320px",fontSize:20,fontWeight:400,lineHeight:0,background:"transparent",borderRadius:"0px",padding:"0px",transition:"all 150ms ease",border:"none","&:focus":{outline:"none",border:"1px solid ".concat(t.palette.grey[900]),borderRadius:"0px"}}})),p=r.createContext((function(){return new Promise((function(e){var t="not implemented";console.log(t),e(t)}))})),O=function(e){var t=e.children,n=r.useState("default"),i=Object(s.a)(n,2),a=i[0],c=i[1],o=r.useState({pos:{x:0,y:0},value:""}),u=Object(s.a)(o,2),h=u[0],d=u[1],j=r.useState([]),b=Object(s.a)(j,2),v=b[0],O=b[1],w=Object(s.a)(v,2),y=w[0],C=w[1],m=r.useCallback((function(e){return d((function(t){return Object(x.a)(Object(x.a)({},t),e)})),new Promise((function(e,t){O([e,t])}))}),[]);r.useEffect((function(){c(h.value)}),[h]);var S=r.useCallback((function(){O([]),d({pos:{x:0,y:0},value:""})}),[]),k=r.useCallback((function(){C&&(C(a),S())}),[C,S,a]),P=r.useRef(),T=r.useCallback((function(){var e;console.log(null===(e=P.current)||void 0===e?void 0:e.getBoundingClientRect()),y&&(y(a),S())}),[y,a,S]);return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(p.Provider,{value:m,children:t}),v.length>0&&Object(l.jsx)("div",{style:{position:"absolute",left:h.pos.x-1,top:h.pos.y-3},children:Object(l.jsx)(f.a,{autoFocus:!0,value:a,placeholder:"Input Text",onChange:function(e){c(e.target.value)},onKeyDown:function(e){"Enter"===e.key?T():"Escape"===e.key&&k()},onBlur:function(){T()},components:{Input:g}})})]})},w=n(367),y=n(368),C=n(21),m=n(36),S=n.n(m),k=n(59),P=n(27),T=n(26),E=function(e){var t=e.point,n=e.value,i=void 0===n?"default":n,a=r.useState(i),c=Object(s.a)(a,2),o=c[0],u=c[1],h=r.useContext(p),d=Object(T.a)();return Object(l.jsx)(P.h,Object(x.a)(Object(x.a)({text:o,fontFamily:d.typography.fontFamily,fontSize:20},t),{},{draggable:!0,onDblClick:function(e){var t,n,r=e.target,i=r.absolutePosition(),a={x:i.x+((null===(t=r.getStage())||void 0===t?void 0:t.container().offsetLeft)||0),y:i.y+((null===(n=r.getStage())||void 0===n?void 0:n.container().offsetTop)||0)};r.hide(),h({pos:a,value:o}).then((function(e){u(e)})).catch((function(e){return console.log(e)})).finally((function(){return r.show()}))},onClick:function(e){return e.evt.preventDefault()}}))},R=["Rect","Circle","Line","Free"],D=r.createContext({shapeType:"Select",setShapeType:function(){throw new Error("setShapeType is not implemented by no wrapping")}}),L=function(e){var t=e.children,n=r.useState("Select"),i=Object(s.a)(n,2),a=i[0],c=i[1];return Object(l.jsx)(D.Provider,{value:{shapeType:a,setShapeType:c},children:t})},F=r.createContext(null),z=r.createContext(null),W=function(e){var t=e.children,n=r.useState({stroke:"black",strokeWidth:1}),i=Object(s.a)(n,2),a=i[0],c=i[1];return Object(l.jsx)(F.Provider,{value:a,children:Object(l.jsx)(z.Provider,{value:c,children:t})})},I=function(){var e=r.useContext(F),t=r.useContext(z);if(null===e||null===t)throw new Error("LineConfigProvider is not wrapped");return[e,t]},M=r.createContext(null),U=r.createContext(null),X=function(e){var t=e.children,n=r.useState({}),i=Object(s.a)(n,2),a=i[0],c=i[1];return Object(l.jsx)(M.Provider,{value:a,children:Object(l.jsx)(U.Provider,{value:c,children:t})})},Y=function(){var e=r.useContext(M),t=r.useContext(U);if(null===e||null===t)throw new Error("ShapeConfigProvider is not wrapped");return[e,t]},B=n(363),H=r.createContext([]),A=r.createContext(null),J=function(e){var t=e.children,n=Object(B.a)([]),r=Object(s.a)(n,2),i=r[0],a=r[1];return Object(l.jsx)(H.Provider,{value:i,children:Object(l.jsx)(A.Provider,{value:a,children:t})})},G=function(){var e=r.useContext(H),t=r.useContext(A);if(null===t)throw new Error("ShapesContextProvider is not wrapped");return[e,t]},K=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=function(e){var t=e.target,n=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),t.width(t.width()*n),t.height(t.height()*r)},c=Object(x.a)({draggable:!0},i);switch(e){case"Circle":var o={x:(t.x+n.x)/2,y:(t.y+n.y)/2},u={x:Math.abs(t.x-n.x)/2,y:Math.abs(t.y-n.y)/2};return Object(l.jsx)(P.a,Object(x.a)(Object(x.a)({x:o.x,y:o.y,radiusX:u.x,radiusY:u.y,fill:"gray",stroke:"blue",onTransformEnd:a},r),c));case"Rect":var s={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y)},h={x:Math.abs(t.x-n.x),y:Math.abs(t.y-n.y)};return Object(l.jsx)(P.f,Object(x.a)(Object(x.a)({x:s.x,y:s.y,width:h.x,height:h.y,fill:"gray",stroke:"blue",onTransformEnd:a},r),c));case"Line":return Object(l.jsx)(P.e,Object(x.a)(Object(x.a)({points:[t.x,t.y,n.x,n.y],stroke:"blue",strokeWidth:4,onTransformEnd:a},r),c))}},N=function(){var e=Object(k.a)(S.a.mark((function e(t){var n,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof File&&t.type.startsWith("image"))){e.next=6;break}return e.next=3,new Promise((function(e,n){var r=new FileReader;r.onload=function(){var t,n=new Image;n.onload=function(){e(n)},n.src=(null===(t=r.result)||void 0===t?void 0:t.toString())||""},r.onerror=function(e){return n(e)},r.readAsDataURL(t)}));case 3:return n=e.sent,r={width:n.width,height:n.height},e.abrupt("return",Object(l.jsx)(P.c,{image:n,x:0,y:0,width:r.width,height:r.height}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$=function(e){var t=e.stageSize,n=e.canvasSize,i=r.useContext(D),a=i.shapeType,c=i.setShapeType,o=r.useState(),u=Object(s.a)(o,2),d=u[0],b=u[1],f=r.useState({x:0,y:0}),v=Object(s.a)(f,2),g=v[0],O=v[1],w=G(),y=Object(s.a)(w,2),m=y[0],T=y[1],R=r.useState([]),L=Object(s.a)(R,2),F=L[0],z=L[1],W=r.useContext(h),M=r.useContext(p),U=r.useState(),X=Object(s.a)(U,2),B=X[0],H=X[1],A=r.useContext(j),J=r.useRef(null),$=r.useState(!1),q=Object(s.a)($,2),Q=q[0],V=q[1],Z=I(),_=Object(s.a)(Z,1)[0],ee=Y(),te=Object(s.a)(ee,1)[0];r.useEffect((function(){void 0!==W&&function(){var e=Object(k.a)(S.a.mark((function e(){var t;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(W);case 2:t=e.sent,T.push(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[W,T]);var ne=function(e,t){"Text"===a?H({x:t.x,y:t.y}):"Free"===a&&z((function(t){return[e.x,e.y,e.x,e.y]})),V(!0),O(e)},re=function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition(),r=e.evt,i=r.clientX,a=r.clientY;n&&ne(n,{x:i,y:a})},ie=function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition(),r=e.evt.touches[0],i=r.clientX,a=r.clientY;n&&ne(n,{x:i,y:a}),e.evt.preventDefault()},ae=function(e){var t,n=null===(t=e.target.getStage())||void 0===t?void 0:t.getPointerPosition();if(n&&Q){if("Free"===a)return void z((function(e){return[].concat(Object(C.a)(e),[n.x,n.y])}));var r=K(a,g,n,_,te);b(r)}e.evt.preventDefault()},ce=function(e){"Text"===a&&B&&(null===A||void 0===A?void 0:A.current)&&M({pos:B,value:""}).then((function(e){if(e){var t=Object(l.jsx)(E,{point:g,value:e});T.push(t)}})),d&&T.push(d),V(!1),b(void 0),z([]),O({x:0,y:0}),c("Select"),e.evt.preventDefault()};r.useEffect((function(){if(F.length>0){var e=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{draggable:!0};return Object(l.jsx)(P.e,Object(x.a)(Object(x.a)({points:e,mode:"source-over",stroke:"blue",strokeWidth:4},t),n))}(F,_);b(e)}}),[F,_]);var oe=r.useState(),ue=Object(s.a)(oe,2),se=ue[0],le=ue[1];r.useEffect((function(){var e={x:t.width,y:t.height},n=K("Rect",{x:0,y:0},e,{},{draggable:!1,fill:"white",stroke:"transparent",listening:!1}),r={x:t.width/2,y:0},i={x:t.width/2,y:t.height},a=K("Line",r,i,{draggable:!1,stroke:"black",strokeWidth:2,lineJoin:"round",dash:[10,10],opacity:.2});le(Object(l.jsxs)(P.b,{children:[n,a]}))}),[t.width,t.height]);var he=function(e){null!==J.current&&"Select"===a&&(e.target!==e.target.getStage()?J.current.nodes([e.target]):J.current.nodes([]))},de=r.useRef(null);return r.useEffect((function(){J.current&&de.current&&J.current.nodes([de.current])}),[]),Object(l.jsx)("div",{style:{flexGrow:1},children:Object(l.jsx)(p.Consumer,{children:function(e){return Object(l.jsx)(P.g,{ref:A,preventDefault:!0,x:t.x,y:t.y,width:t.width,height:t.height,onMouseDown:re,onTouchStart:ie,onDragStart:function(){return d&&b(void 0)},onMouseMove:ae,onTouchMove:ae,onMouseUp:ce,onTouchEnd:ce,onClick:he,onTap:he,children:Object(l.jsx)(p.Provider,{value:e,children:Object(l.jsx)(P.d,{children:Object(l.jsxs)(P.b,{clipX:n.x,clipY:n.y,clipWidth:n.width,clipHeight:n.height,children:[se,r.Children.toArray(m).map((function(e){return e})),d,Object(l.jsx)(P.i,{ref:J})]})})})})}})})},q=n(8),Q=n(369),V=n(365),Z=n(349),_=n(158),ee=n(163),te=n(364),ne=n(372),re=n(373),ie=n(356),ae=n(361),ce=n(362),oe=n(359),ue=n(353),se=n(370),le=n(164),he=function(e){var t=e.color,n=e.setColor;return Object(l.jsxs)(Z.a,{spacing:1,children:[Object(l.jsxs)(se.a,{children:["Color: ",t]}),Object(l.jsx)(le.a,{color:t,onChangeComplete:function(e,t){n(e.hex)}})]})},de=function(){var e,t=I(),n=Object(s.a)(t,2),i=n[0],a=n[1],c=r.useState((null===(e=i.stroke)||void 0===e?void 0:e.toString())||"#000000"),o=Object(s.a)(c,2),u=o[0],h=o[1],d=r.useState(i.strokeWidth||1),j=Object(s.a)(d,2),b=j[0],f=j[1];return r.useEffect((function(){a((function(e){return Object(x.a)(Object(x.a)({},e),{},{stroke:u,strokeWidth:b})}))}),[u,a,b]),Object(l.jsxs)(Z.a,{spacing:2,children:[Object(l.jsxs)(Z.a,{direction:"row",children:[Object(l.jsx)(se.a,{children:"Width"}),Object(l.jsxs)(ae.a,{children:[Object(l.jsx)(ce.a,{id:"line-width-label",children:"line"}),Object(l.jsx)(ue.a,{labelId:"line-width-label",id:"line-width",value:b,label:"Line",onChange:function(e){f(e.target.value)},children:[1,2,3,4,5,6,7,8].map((function(e){return Object(l.jsx)(oe.a,{value:e,children:e},e)}))})]})]}),Object(l.jsx)(he,{color:u,setColor:h})]})},je=function(){var e=Y(),t=Object(s.a)(e,2),n=t[0],i=t[1],a=r.useState(n.fill||"#000000"),c=Object(s.a)(a,2),o=c[0],u=c[1];return r.useEffect((function(){i((function(e){return Object(x.a)(Object(x.a)({},e),{},{fill:o})}))}),[o,i]),Object(l.jsx)(Z.a,{spacing:2,children:Object(l.jsx)(he,{color:o,setColor:u})})},be=Object(q.a)(ne.a)((function(e){var t,n=e.theme;return{position:"absolute",top:Number.parseInt((null===(t=n.mixins.toolbar.minHeight)||void 0===t?void 0:t.toString())||"0")+8,right:8,boxShadow:"none",backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&:active":{boxShadow:"none"}}})),xe=function(e){var t=e.children,n=e.index,r=e.value;return Object(l.jsx)("div",{role:"tabpanel",hidden:r!==n,id:"simple-tabpanel-".concat(n),"aria-labelledby":"simple-tab-".concat(n),children:r===n&&Object(l.jsx)(w.a,{sx:{p:3},children:t})})},fe=function(e){var t=e.open,n=e.onClose,i=r.useState(0),a=Object(s.a)(i,2),c=a[0],o=a[1];return Object(l.jsxs)(te.a,{open:t,anchor:"right",variant:"persistent",onClose:n,children:[Object(l.jsx)(y.a,{}),Object(l.jsxs)(ie.a,{value:c,onChange:function(e,t){o(t)},children:[Object(l.jsx)(re.a,{label:"Line"}),Object(l.jsx)(re.a,{label:"Shape"})]}),Object(l.jsx)(xe,{value:c,index:0,children:Object(l.jsx)(de,{})}),Object(l.jsx)(xe,{value:c,index:1,children:Object(l.jsx)(je,{})}),Object(l.jsx)(be,{disableRipple:!0,disableFocusRipple:!0,disableTouchRipple:!0,variant:"extended",onClick:n,children:Object(l.jsx)(_.a,{icon:ee.a})})]})},ve=r.createContext(null),ge=function(e){var t=e.children,n=r.useState(!1),i=Object(s.a)(n,2),a=i[0],c=i[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(ve.Provider,{value:c,children:t}),Object(l.jsx)(fe,{open:a,onClose:function(){c(!1)}})]})},pe=Object(q.a)("div")((function(e){return{flexGrow:1}})),Oe=function(e){var t=e.canvasSize,n=r.useContext(j),i=function(){var e=r.useContext(ve);if(null===e)throw new Error("ConfigEditorProvider is not wrapped");return e}();return Object(l.jsx)(Q.a,{sx:{zIndex:function(e){return e.zIndex.drawer+1}},children:Object(l.jsxs)(y.a,{children:[Object(l.jsx)(pe,{}),Object(l.jsxs)(Z.a,{direction:"row",spacing:2,children:[Object(l.jsx)(V.a,{variant:"contained",onClick:function(){i(!0)},children:"config"}),Object(l.jsx)(V.a,{onClick:function(){if(null===n||void 0===n?void 0:n.current){var e=n.current.toDataURL({x:t.x,y:t.y,width:t.width,height:t.height}),r=document.createElement("a");r.download="stage.png",r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)}},variant:"contained",children:"Download"})]})]})})},we=function(e){var t=e.handleClose,n=r.useContext(D).setShapeType,i=function(e){var r;r=e.currentTarget.value,R.some((function(e){return e===r}))&&n(e.currentTarget.value),t()};return Object(l.jsx)(Z.a,{direction:"row",spacing:2,children:R.map((function(e){return Object(l.jsx)(V.a,{onClick:i,value:e,children:e},e)}))})},ye=function(e){var t,n=e.canvasSize,i=r.useState(!1),a=Object(s.a)(i,2),c=a[0],o=a[1],u=r.useRef(null),h=r.useContext(D).setShapeType,d=function(){var e=G(),t=Object(s.a)(e,2)[1],n=r.useCallback(function(){var e=Object(k.a)(S.a.mark((function e(t){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new window.Image;r.src=t,r.onload=function(){e(r)},r.onerror=n}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),i=r.useCallback((function(e,n,r){var i={width:e.width,height:e.height},a=.6*n,c=.6*r;(i.width>c||i.height>a)&&(i.width>i.height?(i.height=c*i.height/i.width,i.width=c):(i.width=a*i.width/i.height,i.height=a)),t.push(Object(l.jsx)(P.c,{draggable:!0,image:e,x:(r-i.width)/2,y:(n-i.height)/2,width:i.width,height:i.height}))}),[t]);return r.useCallback(function(){var e=Object(k.a)(S.a.mark((function e(t,r,a){var c,o;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c=URL.createObjectURL(t))){e.next=6;break}return e.next=4,n(c);case 4:o=e.sent,i(o,r,a);case 6:URL.revokeObjectURL(c);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[n,i])}(),j=function(){o(!1)};return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(w.a,{ref:u,sx:{width:"100vw",zIndex:function(e){return e.zIndex.drawer+1}},children:Object(l.jsx)(w.a,{sx:{width:"100%",overflow:"auto"},children:Object(l.jsxs)(Z.a,{direction:"row",spacing:2,children:[Object(l.jsx)(V.a,{onClick:function(){o(!0)},children:"Shape"}),Object(l.jsx)(V.a,{onClick:function(){h("Text")},children:"Text"}),Object(l.jsxs)(V.a,{component:"label",children:[Object(l.jsx)("input",{accept:"image/*",multiple:!0,type:"file",style:{display:"none"},onChange:function(e){var t=Array.from(e.target.files||[]);t.length>0&&t.forEach((function(e){d(e,n.height,n.width)}))}}),"Upload"]})]})})}),Object(l.jsxs)(te.a,{open:c,onClose:j,anchor:"bottom",children:[Object(l.jsx)(we,{handleClose:j}),Object(l.jsx)(w.a,{sx:{height:null===(t=u.current)||void 0===t?void 0:t.clientHeight}})]})]})},Ce=n(358),me=function(){var e=r.useRef(null),t=function(e){var t=Object(Ce.a)(),n=r.useState({stage:{x:0,y:0,width:0,height:0},canvas:{x:0,y:0,width:0,height:0}}),i=Object(s.a)(n,2),a=i[0],c=i[1];return r.useEffect((function(){if(e.current){var t=e.current.clientWidth,n=null===e||void 0===e?void 0:e.current.clientHeight,r={x:0,y:0,width:t,height:n},i={width:0,height:0,x:0,y:0},a=22/21;i.width=.9*t,i.height=i.width/a,i.height>.9*n&&(i.height=.9*n,i.width=i.height*a),i.x=(t-i.width)/2,i.y=(n-i.height)/2,c({stage:r,canvas:i})}}),[e,t.height,t.width]),a}(e),n=t.stage,i=t.canvas;return Object(l.jsxs)(w.a,{sx:{height:"100%",display:"flex",flexDirection:"column",flex:1,position:"relative"},children:[Object(l.jsx)(Oe,{canvasSize:i}),Object(l.jsx)(y.a,{}),Object(l.jsx)(w.a,{sx:{background:"grey",height:"100%",width:"100%",position:"relative",flex:"1 1 0%"},children:Object(l.jsx)(w.a,{ref:e,onCopy:function(){return console.log("handlePaste")},onPaste:function(){return console.log("test")},sx:{position:"absolute",height:"100%",width:"100%",overflow:"hidden auto"},children:Object(l.jsx)($,{stageSize:n,canvasSize:i})})}),Object(l.jsx)(ye,{canvasSize:i})]})},Se=function(e){var t=e.children;return Object(l.jsx)(W,{children:Object(l.jsx)(X,{children:Object(l.jsx)(ge,{children:t})})})},ke=Object(o.a)();var Pe=function(){return Object(l.jsx)("div",{style:{height:"100%"},children:Object(l.jsx)(u.a,{theme:ke,children:Object(l.jsx)(d,{children:Object(l.jsx)(b,{children:Object(l.jsx)(O,{children:Object(l.jsx)(Se,{children:Object(l.jsx)(J,{children:Object(l.jsx)(L,{children:Object(l.jsx)(me,{})})})})})})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,375)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),i(e),a(e),c(e)}))};c.a.render(Object(l.jsx)(i.a.StrictMode,{children:Object(l.jsx)(Pe,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),Te()}},[[299,1,2]]]);
//# sourceMappingURL=main.59a33740.chunk.js.map