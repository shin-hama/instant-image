(this["webpackJsonpinstant-image"]=this["webpackJsonpinstant-image"]||[]).push([[0],{178:function(e,t,n){},298:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(43),c=n.n(i),o=(n(178),n(159)),u=n(355),s=n(9),l=n(1),d=r.createContext(void 0),h=function(e){var t=e.children,n=r.useState(),a=Object(s.a)(n,2),i=a[0],c=a[1],o=function(e){if(null!==e.clipboardData)if(e.clipboardData.files.length>0){var t=e.clipboardData.files[0];c(t)}else c(e.clipboardData.getData("Text"))};return r.useEffect((function(){return document.addEventListener("paste",o),function(){document.removeEventListener("paste",o)}}),[]),Object(l.jsx)(d.Provider,{value:i,children:t})},j=r.createContext(void 0),b=function(e){var t=e.children,n=r.useRef(null);return Object(l.jsx)(j.Provider,{value:n,children:t})},f=n(23),v=n(348),x=n(335),O=Object(x.a)("input")((function(e){var t=e.theme;return{width:"320px",fontSize:20,fontWeight:400,lineHeight:0,background:"transparent",borderRadius:"0px",padding:"0px",transition:"all 150ms ease",border:"none","&:focus":{outline:"none",border:"1px solid ".concat(t.palette.grey[900]),borderRadius:"0px"}}})),p=r.createContext((function(){return new Promise((function(e){var t="not implemented";console.log(t),e(t)}))})),g=function(e){var t=e.children,n=r.useState("default"),a=Object(s.a)(n,2),i=a[0],c=a[1],o=r.useState({pos:{x:0,y:0},value:""}),u=Object(s.a)(o,2),d=u[0],h=u[1],j=r.useState([]),b=Object(s.a)(j,2),x=b[0],g=b[1],w=Object(s.a)(x,2),y=w[0],C=w[1],m=r.useCallback((function(e){return h((function(t){return Object(f.a)(Object(f.a)({},t),e)})),new Promise((function(e,t){g([e,t])}))}),[]);r.useEffect((function(){c(d.value)}),[d]);var S=r.useCallback((function(){g([]),h({pos:{x:0,y:0},value:""})}),[]),k=r.useCallback((function(){C&&(C(i),S())}),[C,S,i]),P=r.useRef(),E=r.useCallback((function(){var e;console.log(null===(e=P.current)||void 0===e?void 0:e.getBoundingClientRect()),y&&(y(i),S())}),[y,i,S]);return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(p.Provider,{value:m,children:t}),x.length>0&&Object(l.jsx)("div",{style:{position:"absolute",left:d.pos.x-1,top:d.pos.y-3},children:Object(l.jsx)(v.a,{autoFocus:!0,value:i,placeholder:"Input Text",onChange:function(e){c(e.target.value)},onKeyDown:function(e){"Enter"===e.key?E():"Escape"===e.key&&k()},onBlur:function(){E()},components:{Input:O}})})]})},w=n(357),y=n(21),C=n(35),m=n.n(C),S=n(55),k=n(28),P=n(31),E=function(e){var t=e.point,n=e.value,a=void 0===n?"default":n,i=r.useState(a),c=Object(s.a)(i,2),o=c[0],u=c[1],d=r.useContext(p),h=Object(P.a)();return Object(l.jsx)(k.g,Object(f.a)(Object(f.a)({text:o,fontFamily:h.typography.fontFamily,fontSize:20},t),{},{draggable:!0,onDblClick:function(e){var t,n,r=e.target,a=r.absolutePosition(),i={x:a.x+((null===(t=r.getStage())||void 0===t?void 0:t.container().offsetLeft)||0),y:a.y+((null===(n=r.getStage())||void 0===n?void 0:n.container().offsetTop)||0)};r.hide(),d({pos:i,value:o}).then((function(e){u(e)})).catch((function(e){return console.log(e)})).finally((function(){return r.show()}))},onClick:function(e){return e.evt.preventDefault()}}))},T=function(){return{width:window.innerWidth,height:window.innerHeight}},L=function(){var e=Object(r.useState)(T()),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=function(){a(T())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n},R=r.createContext(null),F=r.createContext(null),D=function(e){var t=e.children,n=r.useState({stroke:"black",strokeWidth:1}),a=Object(s.a)(n,2),i=a[0],c=a[1];return Object(l.jsx)(R.Provider,{value:i,children:Object(l.jsx)(F.Provider,{value:c,children:t})})},M=function(){var e=r.useContext(R),t=r.useContext(F);if(null===e||null===t)throw new Error("LineConfigProvider is not wrapped");return[e,t]},I=r.createContext(null),W=r.createContext(null),U=function(e){var t=e.children,n=r.useState({}),a=Object(s.a)(n,2),i=a[0],c=a[1];return Object(l.jsx)(I.Provider,{value:i,children:Object(l.jsx)(W.Provider,{value:c,children:t})})},z=function(){var e=r.useContext(I),t=r.useContext(W);if(null===e||null===t)throw new Error("ShapeConfigProvider is not wrapped");return[e,t]},B=n(83),X=n(85),Y=n(360),A=n(353),H=r.createContext([]),J=r.createContext(null),G=function(e){var t=e.children,n=Object(A.a)([]),r=Object(s.a)(n,2),a=r[0],i=r[1];return Object(l.jsx)(H.Provider,{value:a,children:Object(l.jsx)(J.Provider,{value:i,children:t})})},K=function(){var e=r.useContext(H),t=r.useContext(J);if(null===t)throw new Error("ShapesContextProvider is not wrapped");return[e,t]},N=function(){var e=L(),t=function(e,t){var n=r.useState(e),a=Object(s.a)(n,2),i=a[0],c=a[1],o=r.useState(t),u=Object(s.a)(o,2),d=u[0],h=u[1],j=K(),b=Object(s.a)(j,2)[1],f=L();r.useEffect((function(){c(e),h(t)}),[e,t]);var v=r.useCallback(function(){var e=Object(S.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new window.Image;r.src=t,r.onload=function(){e(r)},r.onerror=n}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),x=r.useCallback((function(e){var t={width:e.width,height:e.height};(t.width>i||t.height>d)&&(t.width>t.height?(t.height=i*t.height/t.width,t.width=i):(t.width=d*t.width/t.height,t.height=d)),b.push(Object(l.jsx)(k.b,{draggable:!0,image:e,x:(f.width-i)/2,y:(f.height-d)/2,width:t.width,height:t.height}))}),[b,d,i,f.height,f.width]);return r.useCallback(function(){var e=Object(S.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=URL.createObjectURL(t))){e.next=6;break}return e.next=4,v(n);case 4:r=e.sent,x(r);case 6:URL.revokeObjectURL(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[v,x])}(.6*e.width,.6*e.height);return Object(l.jsxs)(Y.a,{color:"primary",component:"label",sx:{position:"absolute",bottom:40,right:40},children:[Object(l.jsx)(B.a,{icon:X.a}),Object(l.jsx)("input",{accept:"image/*",multiple:!0,id:"upload-image-button",type:"file",style:{display:"none"},onChange:function(e){var n=Array.from(e.target.files||[]);n.length>0&&n.forEach((function(e){t(e)}))}})]})},$=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=function(e){var t=e.target,n=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),t.width(t.width()*n),t.height(t.height()*r)},c=Object(f.a)({draggable:!0},a);switch(e){case"Circle":var o={x:(t.x+n.x)/2,y:(t.y+n.y)/2},u={x:Math.abs(t.x-n.x)/2,y:Math.abs(t.y-n.y)/2};return Object(l.jsx)(k.a,Object(f.a)(Object(f.a)({x:o.x,y:o.y,radiusX:u.x,radiusY:u.y,fill:"gray",stroke:"blue",onTransformEnd:i},r),c));case"Rect":var s={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y)},d={x:Math.abs(t.x-n.x),y:Math.abs(t.y-n.y)};return Object(l.jsx)(k.e,Object(f.a)(Object(f.a)({x:s.x,y:s.y,width:d.x,height:d.y,fill:"gray",stroke:"blue",onTransformEnd:i},r),c));case"Line":return Object(l.jsx)(k.d,Object(f.a)(Object(f.a)({points:[t.x,t.y,n.x,n.y],stroke:"blue",strokeWidth:4,onTransformEnd:i},r),c))}},q=function(){var e=Object(S.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof File&&t.type.startsWith("image"))){e.next=6;break}return e.next=3,new Promise((function(e,n){var r=new FileReader;r.onload=function(){var t,n=new Image;n.onload=function(){e(n)},n.src=(null===(t=r.result)||void 0===t?void 0:t.toString())||""},r.onerror=function(e){return n(e)},r.readAsDataURL(t)}));case 3:return n=e.sent,r={width:n.width,height:n.height},e.abrupt("return",Object(l.jsx)(k.b,{image:n,x:0,y:0,width:r.width,height:r.height}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=r.useContext(pe).shapeType,t=r.useState(),n=Object(s.a)(t,2),a=n[0],i=n[1],c=r.useState({x:0,y:0}),o=Object(s.a)(c,2),u=o[0],h=o[1],b=K(),v=Object(s.a)(b,2),x=v[0],O=v[1],g=r.useState([]),w=Object(s.a)(g,2),C=w[0],P=w[1],T=r.useContext(d),R=r.useContext(p),F=r.useState(),D=Object(s.a)(F,2),I=D[0],W=D[1],U=r.useContext(j),B=r.useRef(null),X=r.useState(!1),Y=Object(s.a)(X,2),A=Y[0],H=Y[1],J=M(),G=Object(s.a)(J,1)[0],Q=z(),V=Object(s.a)(Q,1)[0],Z=L();r.useEffect((function(){void 0!==T&&function(){var e=Object(S.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(T);case 2:t=e.sent,O.push(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[T,O]);var _=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){if("Text"===e){var a=t.evt,i=a.clientX,c=a.clientY;W({x:i,y:c})}else"Free"===e&&P((function(e){return[r.x,r.y,r.x,r.y]}));H(!0),h(r)}},ee=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){if("Text"===e){var a=t.evt.touches[0],i=a.clientX,c=a.clientY;W({x:i,y:c})}else"Free"===e&&P((function(e){return[r.x,r.y,r.x,r.y]}));H(!0),h(r)}t.evt.preventDefault()},te=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r&&A){if("Free"===e)return void P((function(e){return[].concat(Object(y.a)(e),[r.x,r.y])}));var a=$(e,u,r,G,V);i(a)}t.evt.preventDefault()},ne=function(t){"Text"===e&&I&&(null===U||void 0===U?void 0:U.current)&&R({pos:I,value:""}).then((function(e){if(e){var t=Object(l.jsx)(E,{point:u,value:e});O.push(t)}})),a&&O.push(a),H(!1),i(void 0),P([]),h({x:0,y:0}),t.evt.preventDefault()};r.useEffect((function(){if(C.length>0){var e=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{draggable:!0};return Object(l.jsx)(k.d,Object(f.a)(Object(f.a)({points:e,mode:"source-over",stroke:"blue",strokeWidth:4},t),n))}(C,G);i(e)}}),[C,G]);var re=r.useState(),ae=Object(s.a)(re,2),ie=ae[0],ce=ae[1];r.useEffect((function(){if(null===U||void 0===U?void 0:U.current){var e={x:U.current.width(),y:U.current.height()},t=$("Rect",{x:0,y:0},e,{},{fill:"white",stroke:"transparent",listening:!1});ce(t)}}),[U]);var oe=function(t){null!==B.current&&"Select"===e&&(t.target!==t.target.getStage()?B.current.nodes([t.target]):B.current.nodes([]))},ue=r.useRef(null);return r.useEffect((function(){B.current&&ue.current&&B.current.nodes([ue.current])}),[]),Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(p.Consumer,{children:function(e){return Object(l.jsx)(k.f,{ref:U,preventDefault:!0,width:Z.width,height:Z.height,onMouseDown:_,onTouchStart:ee,onDragStart:function(){return a&&i(void 0)},onMouseMove:te,onTouchMove:te,onMouseUp:ne,onTouchEnd:ne,onClick:oe,onTap:oe,children:Object(l.jsx)(p.Provider,{value:e,children:Object(l.jsxs)(k.c,{children:[ie,r.Children.toArray(x).map((function(e){return e})),a,Object(l.jsx)(k.h,{ref:B})]})})})}}),Object(l.jsx)(N,{})]})},V=n(8),Z=n(359),_=n(354),ee=n(351),te=n(352),ne=n(349),re=n(345),ae=n(358),ie=n(356),ce=n(342),oe=n(361),ue=n(158),se=function(e){var t=e.color,n=e.setColor;return Object(l.jsxs)(ce.a,{spacing:1,children:[Object(l.jsxs)(oe.a,{children:["Color: ",t]}),Object(l.jsx)(ue.a,{color:t,onChangeComplete:function(e,t){n(e.hex)}})]})},le=function(){var e,t=M(),n=Object(s.a)(t,2),a=n[0],i=n[1],c=r.useState((null===(e=a.stroke)||void 0===e?void 0:e.toString())||"#000000"),o=Object(s.a)(c,2),u=o[0],d=o[1],h=r.useState(a.strokeWidth||1),j=Object(s.a)(h,2),b=j[0],v=j[1];return r.useEffect((function(){i((function(e){return Object(f.a)(Object(f.a)({},e),{},{stroke:u,strokeWidth:b})}))}),[u,i,b]),Object(l.jsxs)(ce.a,{spacing:2,children:[Object(l.jsxs)(ce.a,{direction:"row",children:[Object(l.jsx)(oe.a,{children:"Width"}),Object(l.jsxs)(ee.a,{children:[Object(l.jsx)(te.a,{id:"line-width-label",children:"line"}),Object(l.jsx)(re.a,{labelId:"line-width-label",id:"line-width",value:b,label:"Line",onChange:function(e){v(e.target.value)},children:[1,2,3,4,5,6,7,8].map((function(e){return Object(l.jsx)(ne.a,{value:e,children:e},e)}))})]})]}),Object(l.jsx)(se,{color:u,setColor:d})]})},de=function(){var e=z(),t=Object(s.a)(e,2),n=t[0],a=t[1],i=r.useState(n.fill||"#000000"),c=Object(s.a)(i,2),o=c[0],u=c[1];return r.useEffect((function(){a((function(e){return Object(f.a)(Object(f.a)({},e),{},{fill:o})}))}),[o,a]),Object(l.jsx)(ce.a,{spacing:2,children:Object(l.jsx)(se,{color:o,setColor:u})})},he={Line:Object(l.jsx)(le,{}),Shape:Object(l.jsx)(de,{})},je=Object(V.a)(Y.a)((function(e){var t,n=e.theme;return{position:"absolute",top:Number.parseInt((null===(t=n.mixins.toolbar.minHeight)||void 0===t?void 0:t.toString())||"0")+8,right:8,boxShadow:"none",backgroundColor:"transparent","&:hover":{backgroundColor:"transparent"},"&:active":{boxShadow:"none"}}})),be=function(e){var t=e.editor,n=e.onClose;return Object(l.jsxs)(ie.a,{open:Boolean(t),anchor:"right",variant:"persistent",onClose:n,children:[Object(l.jsx)(ae.a,{}),Object(l.jsx)(w.a,{sx:{margin:2},children:t?he[t]:Object(l.jsx)(l.Fragment,{})}),Object(l.jsx)(je,{disableRipple:!0,disableFocusRipple:!0,disableTouchRipple:!0,variant:"extended",onClick:n,children:Object(l.jsx)(B.a,{icon:X.b})})]})},fe=r.createContext(null),ve=function(e){var t=e.children,n=r.useState(),a=Object(s.a)(n,2),i=a[0],c=a[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(fe.Provider,{value:c,children:t}),Object(l.jsx)(be,{editor:i,onClose:function(){c(void 0)}})]})},xe=Object(V.a)("div")((function(e){return{flexGrow:1}})),Oe=function(){var e=r.useContext(pe),t=e.shapeType,n=e.setShapeType,a=r.useContext(j),i=function(){var e=r.useContext(fe);if(null===e)throw new Error("ConfigEditorProvider is not wrapped");return e}();return Object(l.jsx)(Z.a,{sx:{zIndex:function(e){return e.zIndex.drawer+1}},children:Object(l.jsxs)(ae.a,{children:[Object(l.jsxs)(ee.a,{children:[Object(l.jsx)(te.a,{id:"shape-select-label",children:"Shape"}),Object(l.jsxs)(re.a,{labelId:"shape-select-label",id:"shape-select",value:t,label:"Shape",onChange:function(e){n(e.target.value)},children:[Object(l.jsx)(ne.a,{value:"Select",children:"Select"}),Object(l.jsx)(ne.a,{value:"Line",children:"Line"}),Object(l.jsx)(ne.a,{value:"Free",children:"Free Line"}),Object(l.jsx)(ne.a,{value:"Rect",children:"Rect"}),Object(l.jsx)(ne.a,{value:"Circle",children:"Circle"}),Object(l.jsx)(ne.a,{value:"Text",children:"Text"})]})]}),Object(l.jsx)(xe,{}),Object(l.jsx)(_.a,{variant:"contained",onClick:function(){i("Line")},children:"line"}),Object(l.jsx)(_.a,{variant:"contained",onClick:function(){i("Shape")},children:"shape"}),Object(l.jsx)(_.a,{onClick:function(){if(null===a||void 0===a?void 0:a.current){var e=a.current.toDataURL(),t=document.createElement("a");t.download="stage.png",t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},variant:"contained",children:"Download"})]})})},pe=r.createContext({shapeType:"Line",setShapeType:function(){}}),ge=function(){var e=r.useState("Select"),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(l.jsx)(w.a,{children:Object(l.jsxs)(pe.Provider,{value:{shapeType:n,setShapeType:a},children:[Object(l.jsx)(Oe,{}),Object(l.jsx)(w.a,{onCopy:function(){return console.log("handlePaste")},onPaste:function(){return console.log("test")},children:Object(l.jsx)(Q,{})})]})})},we=function(e){var t=e.children;return Object(l.jsx)(D,{children:Object(l.jsx)(U,{children:Object(l.jsx)(ve,{children:t})})})},ye=Object(o.a)();var Ce=function(){return Object(l.jsx)(u.a,{theme:ye,children:Object(l.jsx)(h,{children:Object(l.jsx)(b,{children:Object(l.jsx)(g,{children:Object(l.jsx)(we,{children:Object(l.jsx)(G,{children:Object(l.jsx)(ge,{})})})})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,364)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),i(e),c(e)}))};c.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(Ce,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),me()}},[[298,1,2]]]);
//# sourceMappingURL=main.fb83c087.chunk.js.map