(this["webpackJsonpinstant-image"]=this["webpackJsonpinstant-image"]||[]).push([[0],{163:function(e,t,n){},280:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(39),c=n.n(a),i=(n(163),n(152)),u=n(339),s=n(12),l=n(2),d=r.createContext(void 0),f=function(e){var t=e.children,n=r.useState(),o=Object(s.a)(n,2),a=o[0],c=o[1],i=function(e){if(null!==e.clipboardData)if(e.clipboardData.files.length>0){var t=e.clipboardData.files[0];c(t)}else c(e.clipboardData.getData("Text"))};return r.useEffect((function(){return document.addEventListener("paste",i),function(){document.removeEventListener("paste",i)}}),[]),Object(l.jsx)(d.Provider,{value:a,children:t})},h=r.createContext(void 0),j=function(e){var t=e.children,n=r.useRef(null);return Object(l.jsx)(h.Provider,{value:n,children:t})},v=n(25),b=n(332),x=n(320),g=Object(x.a)("input")((function(e){var t=e.theme;return{width:"320px",fontSize:20,fontWeight:400,lineHeight:0,background:"transparent",borderRadius:"0px",padding:"0px",transition:"all 150ms ease",border:"none","&:focus":{outline:"none",border:"1px solid ".concat(t.palette.grey[900]),borderRadius:"0px"}}})),p=r.createContext((function(){return new Promise((function(e){var t="not implemented";console.log(t),e(t)}))})),O=function(e){var t=e.children,n=r.useState("default"),o=Object(s.a)(n,2),a=o[0],c=o[1],i=r.useState({pos:{x:0,y:0},value:""}),u=Object(s.a)(i,2),d=u[0],f=u[1],h=r.useState([]),j=Object(s.a)(h,2),x=j[0],O=j[1],y=Object(s.a)(x,2),m=y[0],w=y[1],C=r.useCallback((function(e){return f((function(t){return Object(v.a)(Object(v.a)({},t),e)})),new Promise((function(e,t){O([e,t])}))}),[]);r.useEffect((function(){c(d.value)}),[d]);var S=r.useCallback((function(){O([]),f({pos:{x:0,y:0},value:""})}),[]),k=r.useCallback((function(){w&&(w(a),S())}),[w,S,a]),T=r.useRef(),E=r.useCallback((function(){var e;console.log(null===(e=T.current)||void 0===e?void 0:e.getBoundingClientRect()),m&&(m(a),S())}),[m,a,S]);return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(p.Provider,{value:C,children:t}),x.length>0&&Object(l.jsx)("div",{style:{position:"absolute",left:d.pos.x-1,top:d.pos.y-3},children:Object(l.jsx)(b.a,{autoFocus:!0,value:a,placeholder:"Input Text",onChange:function(e){c(e.target.value)},onKeyDown:function(e){"Enter"===e.key?E():"Escape"===e.key&&k()},onBlur:function(){E()},components:{Input:g}})})]})},y=n(337),m=n(19),w=n(62),C=n.n(w),S=n(109),k=n(29),T=n(44),E=function(e){var t=e.point,n=e.value,o=void 0===n?"default":n,a=r.useState(o),c=Object(s.a)(a,2),i=c[0],u=c[1],d=r.useContext(p),f=Object(T.a)();return Object(l.jsx)(k.g,Object(v.a)(Object(v.a)({text:i,fontFamily:f.typography.fontFamily,fontSize:20},t),{},{draggable:!0,onDblClick:function(e){var t,n,r=e.target,o=r.absolutePosition(),a={x:o.x+((null===(t=r.getStage())||void 0===t?void 0:t.container().offsetLeft)||0),y:o.y+((null===(n=r.getStage())||void 0===n?void 0:n.container().offsetTop)||0)};r.hide(),d({pos:a,value:i}).then((function(e){u(e)})).catch((function(e){return console.log(e)})).finally((function(){return r.show()}))},onClick:function(e){return e.evt.preventDefault()}}))},P=function(){var e=window;return{width:e.innerWidth,height:e.innerHeight}},D=r.createContext({color:"",setColor:function(){}}),F=function(e){var t=e.children,n=r.useState(""),o=Object(s.a)(n,2),a=o[0],c=o[1];return Object(l.jsx)(D.Provider,{value:{color:a,setColor:c},children:t})},R=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=function(e){var t=e.target,n=t.scaleX(),r=t.scaleY();t.scaleX(1),t.scaleY(1),t.width(t.width()*n),t.height(t.height()*r)},a=Object(v.a)({draggable:!0},r);switch(e){case"Circle":var c={x:(t.x+n.x)/2,y:(t.y+n.y)/2},i={x:Math.abs(t.x-n.x)/2,y:Math.abs(t.y-n.y)/2};return Object(l.jsx)(k.a,Object(v.a)({x:c.x,y:c.y,radiusX:i.x,radiusY:i.y,fill:"gray",stroke:"blue",onTransformEnd:o},a));case"Rect":var u={x:Math.min(t.x,n.x),y:Math.min(t.y,n.y)},s={x:Math.abs(t.x-n.x),y:Math.abs(t.y-n.y)};return Object(l.jsx)(k.e,Object(v.a)({x:u.x,y:u.y,width:s.x,height:s.y,fill:"gray",stroke:"blue",onTransformEnd:o},a));case"Line":return Object(l.jsx)(k.d,Object(v.a)({points:[t.x,t.y,n.x,n.y],stroke:"blue",strokeWidth:4,onTransformEnd:o},a))}},L=function(){var e=Object(S.a)(C.a.mark((function e(t){var n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof File&&t.type.startsWith("image"))){e.next=6;break}return e.next=3,new Promise((function(e,n){var r=new FileReader;r.onload=function(){var t,n=new Image;n.onload=function(){e(n)},n.src=(null===(t=r.result)||void 0===t?void 0:t.toString())||""},r.onerror=function(e){return n(e)},r.readAsDataURL(t)}));case 3:return n=e.sent,r={width:n.width,height:n.height},e.abrupt("return",Object(l.jsx)(k.b,{image:n,x:0,y:0,width:r.width,height:r.height}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=r.useContext(q).shapeType,t=r.useState(),n=Object(s.a)(t,2),o=n[0],a=n[1],c=r.useState({x:0,y:0}),i=Object(s.a)(c,2),u=i[0],f=i[1],j=r.useState([]),b=Object(s.a)(j,2),x=b[0],g=b[1],O=r.useState([]),y=Object(s.a)(O,2),w=y[0],T=y[1],F=r.useContext(d),M=r.useContext(p),W=r.useState(),I=Object(s.a)(W,2),B=I[0],X=I[1],Y=r.useContext(h),z=r.useRef(null),U=r.useState(!1),A=Object(s.a)(U,2),H=A[0],J=A[1],G=r.useContext(D).color,K=function(){var e=Object(r.useState)(P()),t=Object(s.a)(e,2),n=t[0],o=t[1];return Object(r.useEffect)((function(){var e=function(){o(P())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}();r.useEffect((function(){void 0!==F&&function(){var e=Object(S.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(F);case 2:t=e.sent,g((function(e){return[].concat(Object(m.a)(e),[t])}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[F]);var $=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){if("Text"===e){var o=t.evt,a=o.clientX,c=o.clientY;X({x:a,y:c})}else"Free"===e&&T((function(e){return[r.x,r.y,r.x,r.y]}));J(!0),f(r)}},N=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r){if("Text"===e){var o=t.evt.touches[0],a=o.clientX,c=o.clientY;X({x:a,y:c})}else"Free"===e&&T((function(e){return[r.x,r.y,r.x,r.y]}));J(!0),f(r)}t.evt.preventDefault()},Q=function(t){var n,r=null===(n=t.target.getStage())||void 0===n?void 0:n.getPointerPosition();if(r&&H){if("Free"===e)return void T((function(e){return[].concat(Object(m.a)(e),[r.x,r.y])}));var o=R(e,u,r,{fill:G});a(o)}t.evt.preventDefault()},V=function(t){"Text"===e&&B&&(null===Y||void 0===Y?void 0:Y.current)&&M({pos:B,value:""}).then((function(e){if(e){var t=Object(l.jsx)(E,{point:u,value:e});g((function(e){return[].concat(Object(m.a)(e),[t])}))}})),o&&g((function(e){return[].concat(Object(m.a)(e),[o])})),J(!1),a(void 0),f({x:0,y:0}),t.evt.preventDefault()};r.useEffect((function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{draggable:!0};return Object(l.jsx)(k.d,Object(v.a)({points:e,mode:"source-over",stroke:"blue",strokeWidth:4},t))}(w);a(e)}),[w]);var Z=r.useState(),_=Object(s.a)(Z,2),ee=_[0],te=_[1];r.useEffect((function(){if(null===Y||void 0===Y?void 0:Y.current){var e={x:Y.current.width(),y:Y.current.height()},t=R("Rect",{x:0,y:0},e,{fill:"white",stroke:"transparent",listening:!1});te(t)}}),[Y]);var ne=function(t){console.log(t),null!==z.current&&"Select"===e&&(t.target!==t.target.getStage()?z.current.nodes([t.target]):z.current.nodes([]))},re=r.useRef(null);return r.useEffect((function(){z.current&&re.current&&z.current.nodes([re.current])}),[]),Object(l.jsx)(p.Consumer,{children:function(e){return Object(l.jsx)(k.f,{ref:Y,preventDefault:!0,width:K.width,height:K.height,onMouseDown:$,onTouchStart:N,onDragStart:function(){return o&&a(void 0)},onMouseMove:Q,onTouchMove:Q,onMouseUp:V,onTouchEnd:V,onClick:ne,onTap:ne,children:Object(l.jsx)(p.Provider,{value:e,children:Object(l.jsxs)(k.c,{children:[ee,r.Children.toArray(x).map((function(e){return e})),o,Object(l.jsx)(k.h,{ref:z})]})})})}})},W=n(9),I=n(340),B=n(338),X=n(335),Y=n(336),z=n(333),U=n(330),A=n(341),H=n(151),J=n(150),G=function(){var e=r.useContext(D),t=e.color,n=e.setColor;return Object(l.jsx)(J.a,{color:t,onChangeComplete:function(e,t){n(e.hex)}})},K=Object(W.a)("div")((function(e){return{flexGrow:1}})),$=function(){var e=r.useContext(q),t=e.shapeType,n=e.setShapeType,o=r.useContext(h),a=r.useState(!1),c=Object(s.a)(a,2),i=c[0],u=c[1],d=r.useState(null),f=Object(s.a)(d,2),j=f[0],v=f[1];return Object(l.jsx)(I.a,{children:Object(l.jsxs)(A.a,{children:[Object(l.jsxs)(X.a,{children:[Object(l.jsx)(Y.a,{id:"shape-select-label",children:"Shape"}),Object(l.jsxs)(U.a,{labelId:"shape-select-label",id:"shape-select",value:t,label:"Shape",onChange:function(e){n(e.target.value)},children:[Object(l.jsx)(z.a,{value:"Select",children:"Select"}),Object(l.jsx)(z.a,{value:"Line",children:"Line"}),Object(l.jsx)(z.a,{value:"Free",children:"Free Line"}),Object(l.jsx)(z.a,{value:"Rect",children:"Rect"}),Object(l.jsx)(z.a,{value:"Circle",children:"Circle"}),Object(l.jsx)(z.a,{value:"Text",children:"Text"})]})]}),Object(l.jsx)(K,{}),Object(l.jsx)(B.a,{variant:"contained",onClick:function(e){u(!0),v(e.currentTarget)},children:"color"}),Object(l.jsx)(H.a,{open:i,anchorEl:j,onClose:function(){return u(!1)},children:Object(l.jsx)(z.a,{disableRipple:!0,sx:{"&:hover":{background:"none"}},children:Object(l.jsx)(G,{})})}),Object(l.jsx)(B.a,{onClick:function(){if(null===o||void 0===o?void 0:o.current){var e=o.current.toDataURL(),t=document.createElement("a");t.download="stage.png",t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},variant:"contained",children:"Download"})]})})},q=r.createContext({shapeType:"Line",setShapeType:function(){}}),N=function(){var e=r.useState("Select"),t=Object(s.a)(e,2),n=t[0],o=t[1];return Object(l.jsx)(y.a,{children:Object(l.jsxs)(q.Provider,{value:{shapeType:n,setShapeType:o},children:[Object(l.jsx)($,{}),Object(l.jsx)(y.a,{onCopy:function(){return console.log("handlePaste")},onPaste:function(){return console.log("test")},children:Object(l.jsx)(M,{})})]})})},Q=Object(i.a)();var V=function(){return Object(l.jsx)(u.a,{theme:Q,children:Object(l.jsx)(F,{children:Object(l.jsx)(f,{children:Object(l.jsx)(j,{children:Object(l.jsx)(O,{children:Object(l.jsx)(N,{})})})})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,343)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),r(e),o(e),a(e),c(e)}))};c.a.render(Object(l.jsx)(o.a.StrictMode,{children:Object(l.jsx)(V,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),Z()}},[[280,1,2]]]);
//# sourceMappingURL=main.abc06e20.chunk.js.map